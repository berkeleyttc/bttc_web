<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Berkeley Table Tennis Club</title>

  <meta name="description" content="The Berkeley Table Tennis Club is a fun, friendly group of people in the San Francisco Bay Area. Come out and play!">
  <meta name="author" content="Adam Traver">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link rel="stylesheet" href="http://www.google.com/cse/api/overlay.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lobster|PT+Sans+Narrow:400,700">
  <link rel="stylesheet" href="css/style.css?v=1">
  <link rel="stylesheet" href="css/handheld.css?v=1" media="handheld">

  <script src="http://www.google.com/jsapi" type="text/javascript"></script>
  <style type="text/css">
    .auto-style1 {
      color: #A90A08;
    }
    .entry { border: 4px solid #ccc; padding: 10px; margin: 10px; text-align: left; display: inline-block; }
  </style>
</head>
<body>

  <!-- Message for non-Friday days -->
  <div id="message" style="display:none; position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%);">
    <h2>Today is not round robin league day. Please come back on Friday to sign up</h2>
  </div>

  <!-- Phone lookup content shown only on Friday -->
  <div id="lookupContent" style="display:none; position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%);">
    <h3>Enter Your Phone Number - format '5101234567'</h3>
    <form id="lookupForm">
      <input type="text" id="phoneInput" name="phone" placeholder="Enter phone number" required>
      <button type="submit">Submit</button>
    </form>
    <div id="result"></div>
  </div>

  <script>
    // JavaScript to check if today is Friday (5 = Friday)
    var today = new Date().getDay();
    if (today !== 6) {
      document.getElementById("message").style.display = "block";
    } else {
      document.getElementById("lookupContent").style.display = "block";

      // Only attach the event listener if it's Friday
      const scriptUrl = 'https://script.google.com/macros/s/AKfycbwgED7raqcs242IwCSNZGFjtuu3OjdnSdiqlJeufwTH-23lC2iV5TPa2Q5iPYjduPSq/exec';

      document.getElementById('lookupForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const phone = document.getElementById('phoneInput').value.trim();
        if (!phone) {
          document.getElementById('result').innerHTML = '<p style="color:red;">Please enter a phone number.</p>';
          return;
        }
        const url = scriptUrl + '?phone=' + encodeURIComponent(phone);

        fetch(url)
          .then(response => response.json())
          .then(data => {
            const resultDiv = document.getElementById('result');
            if (data.result === "None") {
              resultDiv.innerHTML = '<p style="color:red;">No player found for this phone number. Please contact BTTC support - 510-926-6913  (TEXT MESSAGES ONLY)</p>';
            } else if (Array.isArray(data) && data.length > 0) {
              let htmlContent = '<p style="color:green;">Players found!</p>';
              data.forEach(item => {
                htmlContent += `
                  <div class="entry">
                    <p><strong>First Name:</strong> ${item.first_name}</p>
                    <p><strong>Last Name:</strong> ${item.last_name}</p>
                    <p><strong>Email:</strong> ${item.email}</p>
                    <p><strong>RR league signup date - YYYY-MM-DD:</strong> ${item.rr_league_date}</p>
                    <p>
                      <a href="${item.preFilledUrl}" target="_blank">
                        Click here to register for the league !
                      </a>
                    </p>
                  </div>
                `;
              });
              resultDiv.innerHTML = htmlContent;
            } else {
              resultDiv.innerHTML = '<p style="color:red;">Unexpected response format.</p>';
            }
          })
          .catch(error => {
            console.error('Error:', error);
            document.getElementById('result').innerHTML = '<p style="color:red;">An error occurred. Please try again.</p>';
          });
      });
    }
  </script>
</body>
</html>
